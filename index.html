<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwimTimer Pro - Concurrent Training</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8'
                        },
                        sport: {
                            400: '#06d6a0',
                            500: '#059669',
                            600: '#047857'
                        }
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Navigation -->
    <nav class="bg-gray-800/90 backdrop-blur-sm border-b border-gray-700 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <div class="bg-gradient-to-r from-sport-400 to-primary-500 w-8 h-8 rounded-lg flex items-center justify-center font-bold text-sm">
                        S
                    </div>
                    <h1 class="text-xl font-bold">SwimTimer Pro</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="exportBtn" class="bg-sport-400 hover:bg-sport-500 px-4 py-2 rounded-lg font-medium transition-colors">
                        <i class="fas fa-download mr-2"></i>Export
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Tabs -->
        <div class="border-b border-gray-700 mb-8">
            <nav class="flex space-x-8">
                <button class="tab-btn border-b-2 border-sport-400 text-sport-400 pb-4 px-1 font-medium" data-tab="training">
                    <i class="fas fa-stopwatch mr-2"></i>Training
                </button>
                <button class="tab-btn border-b-2 border-transparent text-gray-400 hover:text-white pb-4 px-1 font-medium" data-tab="athletes">
                    <i class="fas fa-users mr-2"></i>Athletes
                </button>
                <button class="tab-btn border-b-2 border-transparent text-gray-400 hover:text-white pb-4 px-1 font-medium" data-tab="programs">
                    <i class="fas fa-clipboard-list mr-2"></i>Programs
                </button>
                <button class="tab-btn border-b-2 border-transparent text-gray-400 hover:text-white pb-4 px-1 font-medium" data-tab="results">
                    <i class="fas fa-chart-line mr-2"></i>Results
                </button>
            </nav>
        </div>

        <!-- Training Tab -->
        <div id="training-tab" class="tab-content">
            <!-- Session Controls -->
            <div class="bg-gray-800/50 backdrop-blur border border-gray-700 rounded-xl p-6 mb-6">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                    <div>
                        <h2 class="text-2xl font-bold mb-2">Training Session</h2>
                        <div id="sessionStatus" class="text-gray-400">Ready to start training</div>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <button id="startSessionBtn" class="bg-sport-400 hover:bg-sport-500 px-6 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-play mr-2"></i>Start Session
                        </button>
                        <button id="endSessionBtn" class="bg-red-500 hover:bg-red-600 px-6 py-3 rounded-lg font-medium transition-colors hidden">
                            <i class="fas fa-stop mr-2"></i>End Session
                        </button>
                    </div>
                </div>
                
                <!-- Session Info -->
                <div id="sessionInfo" class="grid grid-cols-2 lg:grid-cols-4 gap-4 mt-6 hidden">
                    <div class="bg-gray-700/50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-sport-400" id="activeAthletes">0</div>
                        <div class="text-sm text-gray-400">Active Athletes</div>
                    </div>
                    <div class="bg-gray-700/50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-primary-400" id="completedSets">0</div>
                        <div class="text-sm text-gray-400">Completed Sets</div>
                    </div>
                    <div class="bg-gray-700/50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-yellow-400" id="currentProgram">-</div>
                        <div class="text-sm text-gray-400">Current Program</div>
                    </div>
                    <div class="bg-gray-700/50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-green-400" id="sessionDuration">00:00</div>
                        <div class="text-sm text-gray-400">Session Time</div>
                    </div>
                </div>
            </div>

            <!-- Active Athletes Grid -->
            <div id="activeAthletesGrid" class="grid gap-6 mb-6 hidden">
                <!-- Athletes will be dynamically added here -->
            </div>

            <!-- Session Setup -->
            <div id="sessionSetup" class="grid md:grid-cols-2 gap-6">
                <div class="bg-gray-800/50 backdrop-blur border border-gray-700 rounded-xl p-6">
                    <h3 class="text-xl font-semibold mb-4">Select Program</h3>
                    <div id="programSelection" class="space-y-3">
                        <div class="text-gray-400 text-center py-8">No programs available</div>
                    </div>
                </div>
                
                <div class="bg-gray-800/50 backdrop-blur border border-gray-700 rounded-xl p-6">
                    <h3 class="text-xl font-semibold mb-4">Select Athletes</h3>
                    <div id="athleteSelection" class="space-y-3 max-h-64 overflow-y-auto">
                        <div class="text-gray-400 text-center py-8">No athletes available</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Athletes Tab -->
        <div id="athletes-tab" class="tab-content hidden">
            <div class="bg-gray-800/50 backdrop-blur border border-gray-700 rounded-xl p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Athletes Management</h2>
                    <button id="addAthleteBtn" class="bg-sport-400 hover:bg-sport-500 px-4 py-2 rounded-lg font-medium transition-colors">
                        <i class="fas fa-plus mr-2"></i>Add Athlete
                    </button>
                </div>
                <div id="athletesList" class="space-y-3">
                    <div class="text-gray-400 text-center py-8">No athletes added yet</div>
                </div>
            </div>
        </div>

        <!-- Programs Tab -->
        <div id="programs-tab" class="tab-content hidden">
            <div class="bg-gray-800/50 backdrop-blur border border-gray-700 rounded-xl p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Training Programs</h2>
                    <button id="addProgramBtn" class="bg-sport-400 hover:bg-sport-500 px-4 py-2 rounded-lg font-medium transition-colors">
                        <i class="fas fa-plus mr-2"></i>Add Program
                    </button>
                </div>
                <div id="programsList" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                    <div class="text-gray-400 text-center py-8 col-span-full">No programs added yet</div>
                </div>
            </div>
        </div>

        <!-- Results Tab -->
        <div id="results-tab" class="tab-content hidden">
            <div class="bg-gray-800/50 backdrop-blur border border-gray-700 rounded-xl p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Training Results</h2>
                    <button id="clearResultsBtn" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg font-medium transition-colors">
                        <i class="fas fa-trash mr-2"></i>Clear All
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="border-b border-gray-700">
                                <th class="pb-3 font-medium">Date/Time</th>
                                <th class="pb-3 font-medium">Athlete</th>
                                <th class="pb-3 font-medium">Program</th>
                                <th class="pb-3 font-medium">Set</th>
                                <th class="pb-3 font-medium">Time</th>
                            </tr>
                        </thead>
                        <tbody id="resultsTable">
                            <tr>
                                <td colspan="5" class="text-gray-400 text-center py-8">No results yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Athlete Modal -->
    <div id="athleteModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
        <div class="bg-gray-800 rounded-xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">Add Athlete</h3>
                <button class="modal-close text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="athleteForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Athlete Name</label>
                    <input type="text" id="athleteName" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-sport-400 focus:border-transparent" placeholder="Enter athlete name" required>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" class="modal-close bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg transition-colors">Cancel</button>
                    <button type="submit" class="bg-sport-400 hover:bg-sport-500 px-4 py-2 rounded-lg transition-colors">Add Athlete</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Program Modal -->
    <div id="programModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
        <div class="bg-gray-800 rounded-xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">Add Program</h3>
                <button class="modal-close text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="programForm">
                <div class="grid gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Program Name</label>
                        <input type="text" id="programName" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-sport-400 focus:border-transparent" placeholder="e.g., Sprint Training" required>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Distance (m)</label>
                            <input type="number" id="programDistance" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-sport-400 focus:border-transparent" placeholder="50" min="25" step="25" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Sets</label>
                            <input type="number" id="programSets" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-sport-400 focus:border-transparent" placeholder="4" min="1" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Stroke</label>
                        <select id="programStroke" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-sport-400 focus:border-transparent" required>
                            <option value="">Select stroke</option>
                            <option value="freestyle">Freestyle</option>
                            <option value="backstroke">Backstroke</option>
                            <option value="breaststroke">Breaststroke</option>
                            <option value="butterfly">Butterfly</option>
                            <option value="medley">Individual Medley</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Rest Time (seconds)</label>
                        <input type="number" id="programRestTime" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-sport-400 focus:border-transparent" placeholder="30" min="0">
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" class="modal-close bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg transition-colors">Cancel</button>
                    <button type="submit" class="bg-sport-400 hover:bg-sport-500 px-4 py-2 rounded-lg transition-colors">Add Program</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        class SwimTimerPro {
            constructor() {
                this.athletes = this.loadData('athletes', []);
                this.programs = this.loadData('programs', []);
                this.results = this.loadData('results', []);
                
                this.sessionActive = false;
                this.sessionStartTime = null;
                this.sessionInterval = null;
                this.selectedProgram = null;
                this.activeAthletes = new Map(); // Map of athlete timers
                
                this.init();
            }

            init() {
                this.bindEvents();
                this.renderData();
                this.updateUI();
            }

            bindEvents() {
                // Tab switching
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.switchTab(e.target.dataset.tab);
                    });
                });

                // Session controls
                document.getElementById('startSessionBtn').addEventListener('click', () => this.startSession());
                document.getElementById('endSessionBtn').addEventListener('click', () => this.endSession());

                // Modal controls
                document.getElementById('addAthleteBtn').addEventListener('click', () => this.showModal('athleteModal'));
                document.getElementById('addProgramBtn').addEventListener('click', () => this.showModal('programModal'));
                
                // Modal close buttons
                document.querySelectorAll('.modal-close').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.hideModal(e.target.closest('.fixed'));
                    });
                });

                // Form submissions
                document.getElementById('athleteForm').addEventListener('submit', (e) => this.addAthlete(e));
                document.getElementById('programForm').addEventListener('submit', (e) => this.addProgram(e));

                // Export and clear
                document.getElementById('exportBtn').addEventListener('click', () => this.exportResults());
                document.getElementById('clearResultsBtn').addEventListener('click', () => this.clearResults());
            }

            switchTab(tab) {
                // Update tab buttons
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    if (btn.dataset.tab === tab) {
                        btn.classList.remove('border-transparent', 'text-gray-400');
                        btn.classList.add('border-sport-400', 'text-sport-400');
                    } else {
                        btn.classList.remove('border-sport-400', 'text-sport-400');
                        btn.classList.add('border-transparent', 'text-gray-400');
                    }
                });

                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(`${tab}-tab`).classList.remove('hidden');
            }

            showModal(modalId) {
                document.getElementById(modalId).classList.remove('hidden');
                document.getElementById(modalId).classList.add('flex');
            }

            hideModal(modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                modal.querySelector('form')?.reset();
            }

            startSession() {
                const selectedProgramElement = document.querySelector('input[name="program"]:checked');
                const selectedAthletes = document.querySelectorAll('input[name="athlete"]:checked');

                if (!selectedProgramElement) {
                    this.showNotification('Please select a program', 'error');
                    return;
                }

                if (selectedAthletes.length === 0) {
                    this.showNotification('Please select at least one athlete', 'error');
                    return;
                }

                this.selectedProgram = this.programs.find(p => p.id == selectedProgramElement.value);
                this.sessionActive = true;
                this.sessionStartTime = Date.now();

                // Initialize active athletes
                selectedAthletes.forEach(checkbox => {
                    const athlete = this.athletes.find(a => a.id == checkbox.value);
                    this.activeAthletes.set(athlete.id, {
                        athlete,
                        currentSet: 1,
                        isRunning: false,
                        startTime: 0,
                        elapsedTime: 0,
                        interval: null,
                        completedSets: []
                    });
                });

                this.updateUI();
                this.startSessionTimer();
                this.renderActiveAthletes();
                this.showNotification('Session started successfully!', 'success');
            }

            endSession() {
                if (!confirm('Are you sure you want to end the current session?')) return;

                this.sessionActive = false;
                this.sessionStartTime = null;
                
                // Stop all athlete timers
                this.activeAthletes.forEach((athleteData, athleteId) => {
                    this.stopAthleteTimer(athleteId);
                });
                this.activeAthletes.clear();

                if (this.sessionInterval) {
                    clearInterval(this.sessionInterval);
                    this.sessionInterval = null;
                }

                this.updateUI();
                this.showNotification('Session ended', 'info');
            }

            startSessionTimer() {
                this.sessionInterval = setInterval(() => {
                    const elapsed = Date.now() - this.sessionStartTime;
                    document.getElementById('sessionDuration').textContent = this.formatTime(elapsed, false);
                }, 1000);
            }

            renderActiveAthletes() {
                const grid = document.getElementById('activeAthletesGrid');
                const athletes = Array.from(this.activeAthletes.values());
                
                if (athletes.length === 0) {
                    grid.innerHTML = '';
                    grid.classList.add('hidden');
                    return;
                }

                grid.classList.remove('hidden');
                grid.style.gridTemplateColumns = `repeat(${Math.min(athletes.length, 3)}, 1fr)`;
                
                grid.innerHTML = athletes.map(athleteData => {
                    const { athlete, currentSet, isRunning, completedSets } = athleteData;
                    const isCompleted = currentSet > this.selectedProgram.sets;
                    
                    return `
                        <div class="bg-gray-800/70 backdrop-blur border border-gray-600 rounded-xl p-6 ${isRunning ? 'ring-2 ring-sport-400' : ''} ${isCompleted ? 'opacity-60' : ''}">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 class="text-xl font-bold">${athlete.name}</h3>
                                    <div class="text-gray-400">Set ${Math.min(currentSet, this.selectedProgram.sets)}/${this.selectedProgram.sets}</div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 rounded-full ${isRunning ? 'bg-sport-400 animate-pulse' : isCompleted ? 'bg-green-400' : 'bg-gray-500'}"></div>
                                    <span class="text-sm">${isRunning ? 'Running' : isCompleted ? 'Complete' : 'Ready'}</span>
                                </div>
                            </div>
                            
                            <div class="text-center mb-6">
                                <div class="text-4xl font-mono font-bold mb-2" id="timer-${athlete.id}">00:00.000</div>
                                <div class="text-sm text-gray-400">${this.selectedProgram.distance}m ${this.selectedProgram.stroke}</div>
                            </div>
                            
                            <div class="flex justify-center space-x-3">
                                ${!isCompleted ? `
                                    <button onclick="app.toggleAthleteTimer(${athlete.id})" 
                                            class="${isRunning ? 'bg-red-500 hover:bg-red-600' : 'bg-sport-400 hover:bg-sport-500'} px-4 py-2 rounded-lg font-medium transition-colors">
                                        <i class="fas ${isRunning ? 'fa-pause' : 'fa-play'} mr-2"></i>
                                        ${isRunning ? 'Pause' : 'Start'}
                                    </button>
                                    <button onclick="app.finishAthleteSet(${athlete.id})" 
                                            class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg font-medium transition-colors ${!isRunning ? 'opacity-50' : ''}"
                                            ${!isRunning ? 'disabled' : ''}>
                                        <i class="fas fa-check mr-2"></i>Finish
                                    </button>
                                    <button onclick="app.resetAthleteTimer(${athlete.id})" 
                                            class="bg-gray-500 hover:bg-gray-600 px-4 py-2 rounded-lg font-medium transition-colors">
                                        <i class="fas fa-undo mr-2"></i>Reset
                                    </button>
                                ` : ''}
                            </div>
                            
                            ${completedSets.length > 0 ? `
                                <div class="mt-4 pt-4 border-t border-gray-600">
                                    <div class="text-sm text-gray-400 mb-2">Completed Sets:</div>
                                    <div class="space-y-1">
                                        ${completedSets.map((set, index) => `
                                            <div class="flex justify-between text-sm">
                                                <span>Set ${index + 1}</span>
                                                <span class="font-mono">${set.formattedTime}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
            }

            toggleAthleteTimer(athleteId) {
                const athleteData = this.activeAthletes.get(athleteId);
                if (!athleteData) return;

                if (athleteData.isRunning) {
                    this.stopAthleteTimer(athleteId);
                } else {
                    this.startAthleteTimer(athleteId);
                }
            }

            startAthleteTimer(athleteId) {
                const athleteData = this.activeAthletes.get(athleteId);
                if (!athleteData) return;

                if (athleteData.elapsedTime === 0) {
                    athleteData.startTime = Date.now();
                } else {
                    athleteData.startTime = Date.now() - athleteData.elapsedTime;
                }

                athleteData.isRunning = true;
                athleteData.interval = setInterval(() => {
                    athleteData.elapsedTime = Date.now() - athleteData.startTime;
                    document.getElementById(`timer-${athleteId}`).textContent = this.formatTime(athleteData.elapsedTime);
                }, 10);

                this.renderActiveAthletes();
            }

            stopAthleteTimer(athleteId) {
                const athleteData = this.activeAthletes.get(athleteId);
                if (!athleteData) return;

                athleteData.isRunning = false;
                if (athleteData.interval) {
                    clearInterval(athleteData.interval);
                    athleteData.interval = null;
                }

                athleteData.elapsedTime = Date.now() - athleteData.startTime;
                this.renderActiveAthletes();
            }

            resetAthleteTimer(athleteId) {
                const athleteData = this.activeAthletes.get(athleteId);
                if (!athleteData) return;

                this.stopAthleteTimer(athleteId);
                athleteData.elapsedTime = 0;
                athleteData.startTime = 0;
                document.getElementById(`timer-${athleteId}`).textContent = '00:00.000';
                this.renderActiveAthletes();
            }

            finishAthleteSet(athleteId) {
                const athleteData = this.activeAthletes.get(athleteId);
                if (!athleteData || !athleteData.isRunning) return;

                const finishTime = athleteData.elapsedTime;
                this.stopAthleteTimer(athleteId);

                // Record result
                const result = {
                    id: Date.now() + athleteId,
                    timestamp: new Date().toISOString(),
                    athleteId: athleteId,
                    athleteName: athleteData.athlete.name,
                    programId: this.selectedProgram.id,
                    programName: this.selectedProgram.name,
                    setNumber: athleteData.currentSet,
                    distance: this.selectedProgram.distance,
                    stroke: this.selectedProgram.stroke,
                    time: finishTime,
                    formattedTime: this.formatTime(finishTime)
                };

                this.results.push(result);
                athleteData.completedSets.push(result);

                // Move to next set
                athleteData.currentSet++;
                athleteData.elapsedTime = 0;
                athleteData.startTime = 0;

                this.saveData('results', this.results);
                this.updateUI();
                this.renderActiveAthletes();
                this.renderResults();

                this.showNotification(`${athleteData.athlete.name} finished Set ${athleteData.currentSet - 1}: ${this.formatTime(finishTime)}`, 'success');
            }

            addAthlete(e) {
                e.preventDefault();
                const name = document.getElementById('athleteName').value.trim();
                if (!name) return;

                const athlete = {
                    id: Date.now(),
                    name,
                    createdAt: new Date().toISOString()
                };

                this.athletes.push(athlete);
                this.saveData('athletes', this.athletes);
                this.renderData();
                this.hideModal(document.getElementById('athleteModal'));
                this.showNotification(`Athlete "${name}" added successfully`, 'success');
            }

            addProgram(e) {
                e.preventDefault();
                const program = {
                    id: Date.now(),
                    name: document.getElementById('programName').value.trim(),
                    distance: parseInt(document.getElementById('programDistance').value),
                    sets: parseInt(document.getElementById('programSets').value),
                    stroke: document.getElementById('programStroke').value,
                    restTime: parseInt(document.getElementById('programRestTime').value) || 0,
                    createdAt: new Date().toISOString()
                };

                this.programs.push(program);
                this.saveData('programs', this.programs);
                this.renderData();
                this.hideModal(document.getElementById('programModal'));
                this.showNotification(`Program "${program.name}" added successfully`, 'success');
            }

            deleteAthlete(id) {
                if (!confirm('Are you sure you want to delete this athlete?')) return;
                this.athletes = this.athletes.filter(a => a.id !== id);
                this.saveData('athletes', this.athletes);
                this.renderData();
                this.showNotification('Athlete deleted', 'info');
            }

            deleteProgram(id) {
                if (!confirm('Are you sure you want to delete this program?')) return;
                this.programs = this.programs.filter(p => p.id !== id);
                this.saveData('programs', this.programs);
                this.renderData();
                this.showNotification('Program deleted', 'info');
            }

            clearResults() {
                if (!confirm('Are you sure you want to clear all results? This cannot be undone.')) return;
                this.results = [];
                this.saveData('results', this.results);
                this.renderResults();
                this.showNotification('All results cleared', 'info');
            }

            exportResults() {
                if (this.results.length === 0) {
                    this.showNotification('No results to export', 'warning');
                    return;
                }

                const headers = ['Date', 'Time', 'Athlete', 'Program', 'Set', 'Distance', 'Stroke', 'Result Time'];
                const csvContent = [
                    headers.join(','),
                    ...this.results.map(result => [
                        new Date(result.timestamp).toLocaleDateString(),
                        new Date(result.timestamp).toLocaleTimeString(),
                        result.athleteName,
                        result.programName,
                        result.setNumber,
                        result.distance,
                        result.stroke,
                        result.formattedTime
                    ].join(','))
                ].join('\n');

                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `swim-results-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                URL.revokeObjectURL(url);

                this.showNotification('Results exported successfully', 'success');
            }

            renderData() {
                this.renderAthletes();
                this.renderPrograms();
                this.renderProgramSelection();
                this.renderAthleteSelection();
                this.renderResults();
            }

            renderAthletes() {
                const container = document.getElementById('athletesList');
                if (this.athletes.length === 0) {
                    container.innerHTML = '<div class="text-gray-400 text-center py-8">No athletes added yet</div>';
                    return;
                }

                container.innerHTML = this.athletes.map(athlete => `
                    <div class="bg-gray-700/50 rounded-lg p-4 flex justify-between items-center">
                        <div>
                            <div class="font-medium">${athlete.name}</div>
                            <div class="text-sm text-gray-400">Added ${new Date(athlete.createdAt).toLocaleDateString()}</div>
                        </div>
                        <button onclick="app.deleteAthlete(${athlete.id})" class="text-red-400 hover:text-red-300 p-2">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `).join('');
            }

            renderPrograms() {
                const container = document.getElementById('programsList');
                if (this.programs.length === 0) {
                    container.innerHTML = '<div class="text-gray-400 text-center py-8 col-span-full">No programs added yet</div>';
                    return;
                }

                container.innerHTML = this.programs.map(program => `
                    <div class="bg-gray-700/50 rounded-lg p-6">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-xl font-semibold">${program.name}</h3>
                            <button onclick="app.deleteProgram(${program.id})" class="text-red-400 hover:text-red-300 p-1">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <div class="text-gray-400">Distance</div>
                                <div class="font-medium">${program.distance}m</div>
                            </div>
                            <div>
                                <div class="text-gray-400">Sets</div>
                                <div class="font-medium">${program.sets}</div>
                            </div>
                            <div>
                                <div class="text-gray-400">Stroke</div>
                                <div class="font-medium capitalize">${program.stroke}</div>
                            </div>
                            <div>
                                <div class="text-gray-400">Rest</div>
                                <div class="font-medium">${program.restTime}s</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            renderProgramSelection() {
                const container = document.getElementById('programSelection');
                if (this.programs.length === 0) {
                    container.innerHTML = '<div class="text-gray-400 text-center py-8">No programs available</div>';
                    return;
                }

                container.innerHTML = this.programs.map(program => `
                    <label class="flex items-center p-3 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-gray-700/70">
                        <input type="radio" name="program" value="${program.id}" class="mr-3 accent-sport-400">
                        <div class="flex-1">
                            <div class="font-medium">${program.name}</div>
                            <div class="text-sm text-gray-400">${program.distance}m ${program.stroke} • ${program.sets} sets</div>
                        </div>
                    </label>
                `).join('');
            }

            renderAthleteSelection() {
                const container = document.getElementById('athleteSelection');
                if (this.athletes.length === 0) {
                    container.innerHTML = '<div class="text-gray-400 text-center py-8">No athletes available</div>';
                    return;
                }

                container.innerHTML = this.athletes.map(athlete => `
                    <label class="flex items-center p-3 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-gray-700/70">
                        <input type="checkbox" name="athlete" value="${athlete.id}" class="mr-3 accent-sport-400">
                        <div class="font-medium">${athlete.name}</div>
                    </label>
                `).join('');
            }

            renderResults() {
                const tbody = document.getElementById('resultsTable');
                if (this.results.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-gray-400 text-center py-8">No results yet</td></tr>';
                    return;
                }

                tbody.innerHTML = this.results
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                    .map(result => `
                        <tr class="border-b border-gray-700">
                            <td class="py-3">${new Date(result.timestamp).toLocaleString()}</td>
                            <td class="py-3">${result.athleteName}</td>
                            <td class="py-3">${result.programName}</td>
                            <td class="py-3">${result.setNumber}</td>
                            <td class="py-3 font-mono font-bold text-sport-400">${result.formattedTime}</td>
                        </tr>
                    `).join('');
            }

            updateUI() {
                // Session controls
                if (this.sessionActive) {
                    document.getElementById('startSessionBtn').classList.add('hidden');
                    document.getElementById('endSessionBtn').classList.remove('hidden');
                    document.getElementById('sessionInfo').classList.remove('hidden');
                    document.getElementById('sessionSetup').classList.add('hidden');
                    
                    // Update session stats
                    document.getElementById('activeAthletes').textContent = this.activeAthletes.size;
                    document.getElementById('completedSets').textContent = this.results.filter(r => 
                        Array.from(this.activeAthletes.keys()).includes(r.athleteId)
                    ).length;
                    document.getElementById('currentProgram').textContent = this.selectedProgram?.name || '-';
                } else {
                    document.getElementById('startSessionBtn').classList.remove('hidden');
                    document.getElementById('endSessionBtn').classList.add('hidden');
                    document.getElementById('sessionInfo').classList.add('hidden');
                    document.getElementById('sessionSetup').classList.remove('hidden');
                    document.getElementById('activeAthletesGrid').classList.add('hidden');
                }

                // Update session status
                const statusElement = document.getElementById('sessionStatus');
                if (this.sessionActive) {
                    statusElement.textContent = `Training in progress • ${this.activeAthletes.size} athletes active`;
                } else {
                    statusElement.textContent = 'Ready to start training';
                }
            }

            formatTime(milliseconds, showMilliseconds = true) {
                const totalSeconds = Math.floor(milliseconds / 1000);
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                const ms = Math.floor((milliseconds % 1000) / 10);

                if (showMilliseconds) {
                    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${ms.toString().padStart(2, '0')}0`;
                } else {
                    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                const colors = {
                    success: 'bg-green-500',
                    error: 'bg-red-500',
                    warning: 'bg-yellow-500',
                    info: 'bg-blue-500'
                };

                notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-x-full`;
                notification.textContent = message;

                document.body.appendChild(notification);

                // Animate in
                setTimeout(() => {
                    notification.classList.remove('translate-x-full');
                }, 10);

                // Animate out and remove
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }

            loadData(key, defaultValue) {
                const data = JSON.parse(window.localStorage?.getItem(`swimTimer_${key}`) || 'null');
                return data || defaultValue;
            }

            saveData(key, data) {
                if (window.localStorage) {
                    window.localStorage.setItem(`swimTimer_${key}`, JSON.stringify(data));
                }
            }
        }

        // Initialize the application
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new SwimTimerPro();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT') return;
            
            switch (e.key) {
                case 'Escape':
                    document.querySelectorAll('.fixed.flex').forEach(modal => {
                        modal.classList.add('hidden');
                        modal.classList.remove('flex');
                    });
                    break;
            }
        });
    </script>
</body>
</html>


<!-- ! Fitur yang masih harus diperbaiki-->
<!-- TODO: 1. TAMBAHKAN FITUR UNTUK START SECARA BERSAMAAN DAN PERBAIKI UINYA UNTUK MEMPERMUDAH PERHITUNGAN WAKTU KALO ATLETNYA BANYAK -->
<!-- TODO: 2. PERBAIKI FITUR PROGRAM LOGIKANYA | BUAT SESI LATIHAN -> TAMBAHKAN PROGRAM2 -> KALO PROGRAM 1 SENYA SUDAH BERES LANJUT KE PROGRAM SELANJUTNYA -->
   <!-- TODO: SAMPAI PROGRAM KE N  -->
<!-- TODO: 3. SESUAIKAN LAGI TEMANYA SUPAYA SELARAS DENGAN MAIN PAGE  -->
